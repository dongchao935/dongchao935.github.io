<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

<!-- 标题 -->
<title>使用golang开发Tcp服务端和客户端的例子 | 一个智慧锦囊</title>

<!-- 网站描述 -->
<meta name="description" content="我的个人总结">
<meta name="keywords" content="tcp server,tcp client,golang网络编程">
<meta name="author" content="智慧锦囊">

<!-- Open Graph -->
<meta property="og:type" content="article">
<meta property="og:title" content="使用golang开发Tcp服务端和客户端的例子">
<meta property="og:description" content="我的个人总结">
<meta property="og:url" content="https://dongchao935.github.io/%E4%BD%BF%E7%94%A8golang%E5%BC%80%E5%8F%91Tcp%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%92%8C%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E4%BE%8B%E5%AD%90/index.html">
<meta property="og:site_name" content="一个智慧锦囊">


<!-- Favicon -->

<link rel="icon" href="/images/favicon.ico">


<!-- 预连接 -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<!-- 字体 -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+SC:wght@400;500;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

<!-- 样式表 -->

<link rel="stylesheet" href="/css/style.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css" />

<!-- RSS -->


<!-- 规范链接 -->
<link rel="canonical" href="https://dongchao935.github.io/%E4%BD%BF%E7%94%A8golang%E5%BC%80%E5%8F%91Tcp%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%92%8C%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E4%BE%8B%E5%AD%90/index.html">

<!-- 主题色 -->
<meta name="theme-color" content="#2563eb" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#1e293b" media="(prefers-color-scheme: dark)">

<!-- 自定义样式变量 -->
<style>
  :root {
    --primary-color: #2563eb;
  }
</style>

<meta name="generator" content="Hexo 8.1.1"></head>
<body>
  <header class="site-header">
  <div class="header-container">
    <!-- Logo / 站点标题 -->
    <div class="site-brand">
      <a href="/" class="site-logo">
        
          <span class="site-title">一个智慧锦囊</span>
        
      </a>
    </div>

    <!-- 导航菜单 -->
    <nav class="site-nav">
      <ul class="nav-list">
        
          <li class="nav-item">
            <a href="/" 
               class="nav-link ">
              首页
            </a>
          </li>
        
          <li class="nav-item">
            <a href="/archives" 
               class="nav-link ">
              归档
            </a>
          </li>
        
          <li class="nav-item">
            <a href="/tags" 
               class="nav-link ">
              标签
            </a>
          </li>
        
          <li class="nav-item">
            <a href="/friends" 
               class="nav-link ">
              友链
            </a>
          </li>
        
          <li class="nav-item">
            <a href="/about" 
               class="nav-link ">
              关于
            </a>
          </li>
        
      </ul>
    </nav>

    <!-- 工具栏 -->
    <div class="header-tools">
      <!-- 搜索按钮 -->
      
        <button class="tool-btn search-toggle" aria-label="搜索" title="搜索">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.3-4.3"></path>
          </svg>
        </button>
      

      <!-- 主题切换 -->
      
        <button class="tool-btn theme-toggle" aria-label="切换主题" title="切换主题">
          <svg class="icon-sun" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="4"></circle>
            <path d="M12 2v2"></path>
            <path d="M12 20v2"></path>
            <path d="m4.93 4.93 1.41 1.41"></path>
            <path d="m17.66 17.66 1.41 1.41"></path>
            <path d="M2 12h2"></path>
            <path d="M20 12h2"></path>
            <path d="m6.34 17.66-1.41 1.41"></path>
            <path d="m19.07 4.93-1.41 1.41"></path>
          </svg>
          <svg class="icon-moon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path>
          </svg>
        </button>
      

      <!-- 移动端菜单按钮 -->
      <button class="tool-btn menu-toggle" aria-label="菜单" title="菜单">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="4" x2="20" y1="12" y2="12"></line>
          <line x1="4" x2="20" y1="6" y2="6"></line>
          <line x1="4" x2="20" y1="18" y2="18"></line>
        </svg>
      </button>
    </div>
  </div>

  <!-- 移动端导航 -->
  <div class="mobile-nav">
    <ul class="mobile-nav-list">
      
        <li class="mobile-nav-item">
          <a href="/" 
             class="mobile-nav-link ">
            首页
          </a>
        </li>
      
        <li class="mobile-nav-item">
          <a href="/archives" 
             class="mobile-nav-link ">
            归档
          </a>
        </li>
      
        <li class="mobile-nav-item">
          <a href="/tags" 
             class="mobile-nav-link ">
            标签
          </a>
        </li>
      
        <li class="mobile-nav-item">
          <a href="/friends" 
             class="mobile-nav-link ">
            友链
          </a>
        </li>
      
        <li class="mobile-nav-item">
          <a href="/about" 
             class="mobile-nav-link ">
            关于
          </a>
        </li>
      
    </ul>
  </div>
</header>

  
  <main class="main-content">
    <div class="container">
      <div class="page-layout post-layout">
  <article class="post-article">
    <!-- 文章头部 -->
    <header class="post-header">
      <h1 class="post-title">使用golang开发Tcp服务端和客户端的例子</h1>
      
      <!-- 元信息 -->
      <div class="post-meta">
  <!-- 发布日期 -->
  <span class="meta-item meta-date">
    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <rect width="18" height="18" x="3" y="4" rx="2" ry="2"></rect>
      <line x1="16" x2="16" y1="2" y2="6"></line>
      <line x1="8" x2="8" y1="2" y2="6"></line>
      <line x1="3" x2="21" y1="10" y2="10"></line>
    </svg>
    <time datetime="2026-02-13">
      2026-02-13
    </time>
  </span>

  <!-- 更新日期 -->
  
    <span class="meta-item meta-updated">
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"></path>
        <path d="M21 3v5h-5"></path>
      </svg>
      <time datetime="2026-02-13">
        更新于 2026-02-13
      </time>
    </span>
  

  <!-- 字数统计 -->
  
    <span class="meta-item meta-wordcount">
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M17 6.1H3"></path>
        <path d="M21 12.1H3"></path>
        <path d="M15.1 18H3"></path>
      </svg>
      
      12.0k 字
    </span>
  

  <!-- 阅读时间 -->
  
    <span class="meta-item meta-readtime">
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <polyline points="12 6 12 12 16 14"></polyline>
      </svg>
      
      约 41 分钟
    </span>
  

  <!-- 标签（仅在列表页显示前几个） -->
  
</div>

      
      <!-- 封面图 -->
      
    </header>

    <!-- 文章内容 -->
    <div class="post-content markdown-body">
      <blockquote>
<p>作者：getyouyou<br>链接：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/dbc62a879081">https://www.jianshu.com/p/dbc62a879081</a><br>来源：简书<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>
</blockquote>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>新工作接手了公司的一个使用golang编写的agent程序，用于采集各个机器的性能指标和监控数据，之前使用http实现数据的上传，最近想把它改成tcp上传的方式，由于是新手上路，顺手写了一个小demo程序。</p>
<p>这个程序中包含：</p>
<ul>
<li>简单的TcpServer服务程序：侦听，数据收发与解析</li>
<li>简单的客户端程序：数据收发与解析</li>
</ul>
<h2 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h2><ul>
<li><p>与正常的其他语言一样，go中也提供了丰富的网络相关的包，按照正常的套路，它是这样的：</p>
</li>
<li><p>绑定端口，初始化套接字</p>
</li>
<li><p>启动侦听，开启后台线程接收客户端请求</p>
</li>
<li><p>接收请求，针对每个请求开启一个线程来处理通信</p>
</li>
<li><p>资源回收</p>
</li>
</ul>
<p>golang的套路也是如此，不同的地方在于它可以使用goroutine来替换上面的线程；</p>
<p>整体的代码很简单，可以参考文档和api手册，示例代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">    &quot;fmt&quot;</span><br><span class="line">    &quot;net&quot;</span><br><span class="line">    &quot;os&quot;</span><br><span class="line">    &quot;encoding/json&quot;</span><br><span class="line">    &quot;bufio&quot;</span><br><span class="line">    &quot;hash/crc32&quot;</span><br><span class="line">    &quot;io&quot;</span><br><span class="line">)</span><br><span class="line">//数据包的类型</span><br><span class="line">const (</span><br><span class="line">    HEART_BEAT_PACKET = 0x00</span><br><span class="line">    REPORT_PACKET = 0x01</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">var (</span><br><span class="line">    server = &quot;127.0.0.1:8080&quot;</span><br><span class="line">)</span><br><span class="line">//这里是包的结构体，其实是可以不需要的</span><br><span class="line">type Packet struct &#123;</span><br><span class="line">    PacketType      byte</span><br><span class="line">    PacketContent     []byte</span><br><span class="line">&#125;</span><br><span class="line">//心跳包，这里用了json来序列化，也可以用github上的gogo/protobuf包</span><br><span class="line">//具体见(https://github.com/gogo/protobuf)</span><br><span class="line">type HeartPacket struct &#123;</span><br><span class="line">    Version     string`json:&quot;version&quot;`</span><br><span class="line">    Timestamp   int64`json:&quot;timestamp&quot;`</span><br><span class="line">&#125;</span><br><span class="line">//正式上传的数据包</span><br><span class="line">type ReportPacket struct &#123;</span><br><span class="line">    Content   string`json:&quot;content&quot;`</span><br><span class="line">    Rand         int`json:&quot;rand&quot;`</span><br><span class="line">    Timestamp   int64`json:&quot;timestamp&quot;`</span><br><span class="line">&#125;</span><br><span class="line">//与服务器相关的资源都放在这里面</span><br><span class="line">type TcpServer struct &#123;</span><br><span class="line">    listener       *net.TCPListener</span><br><span class="line">    hawkServer  *net.TCPAddr</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">    //类似于初始化套接字，绑定端口</span><br><span class="line">    hawkServer, err := net.ResolveTCPAddr(&quot;tcp&quot;, server)</span><br><span class="line">    checkErr(err)</span><br><span class="line">    //侦听</span><br><span class="line">    listen, err := net.ListenTCP(&quot;tcp&quot;, hawkServer)</span><br><span class="line">    checkErr(err)</span><br><span class="line">    //记得关闭</span><br><span class="line">    defer listen.Close()</span><br><span class="line">    tcpServer := &amp;TcpServer&#123;</span><br><span class="line">        listener:listen,</span><br><span class="line">        hawkServer:hawkServer,</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(&quot;start server successful......&quot;)</span><br><span class="line">    //开始接收请求</span><br><span class="line">    for &#123;</span><br><span class="line">        conn, err := tcpServer.listener.Accept()</span><br><span class="line">        fmt.Println(&quot;accept tcp client %s&quot;,conn.RemoteAddr().String())</span><br><span class="line">        checkErr(err)</span><br><span class="line">        // 每次建立一个连接就放到单独的协程内做处理</span><br><span class="line">        go Handle(conn)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//处理函数，这是一个状态机</span><br><span class="line">//根据数据包来做解析</span><br><span class="line">//数据包的格式为|0xFF|0xFF|len(高)|len(低)|Data|CRC高16位|0xFF|0xFE</span><br><span class="line">//其中len为data的长度，实际长度为len(高)*256+len(低)</span><br><span class="line">//CRC为32位CRC，取了最高16位共2Bytes</span><br><span class="line">//0xFF|0xFF和0xFF|0xFE类似于前导码</span><br><span class="line">func Handle(conn net.Conn) &#123;</span><br><span class="line">    // close connection before exit</span><br><span class="line">    defer conn.Close()</span><br><span class="line">    // 状态机状态</span><br><span class="line">    state := 0x00</span><br><span class="line">    // 数据包长度</span><br><span class="line">    length := uint16(0)</span><br><span class="line">    // crc校验和</span><br><span class="line">    crc16 := uint16(0)</span><br><span class="line">    var recvBuffer []byte</span><br><span class="line">    // 游标</span><br><span class="line">    cursor := uint16(0)</span><br><span class="line">    bufferReader := bufio.NewReader(conn)</span><br><span class="line">    //状态机处理数据</span><br><span class="line">    for &#123;</span><br><span class="line">        recvByte,err := bufferReader.ReadByte()</span><br><span class="line">        if err != nil &#123;</span><br><span class="line">            //这里因为做了心跳，所以就没有加deadline时间，如果客户端断开连接</span><br><span class="line">            //这里ReadByte方法返回一个io.EOF的错误，具体可考虑文档</span><br><span class="line">            if err == io.EOF &#123;</span><br><span class="line">                fmt.Printf(&quot;client %s is close!\n&quot;,conn.RemoteAddr().String())</span><br><span class="line">            &#125;</span><br><span class="line">            //在这里直接退出goroutine，关闭由defer操作完成</span><br><span class="line">            return</span><br><span class="line">        &#125;</span><br><span class="line">        //进入状态机，根据不同的状态来处理</span><br><span class="line">        switch state &#123;</span><br><span class="line">        case 0x00:</span><br><span class="line">            if recvByte == 0xFF &#123;</span><br><span class="line">                state = 0x01</span><br><span class="line">                //初始化状态机</span><br><span class="line">                recvBuffer = nil</span><br><span class="line">                length = 0</span><br><span class="line">                crc16 = 0</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                state = 0x00</span><br><span class="line">            &#125;</span><br><span class="line">            break</span><br><span class="line">        case 0x01:</span><br><span class="line">            if recvByte == 0xFF &#123;</span><br><span class="line">                state = 0x02</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                state = 0x00</span><br><span class="line">            &#125;</span><br><span class="line">            break</span><br><span class="line">        case 0x02:</span><br><span class="line">            length += uint16(recvByte) * 256</span><br><span class="line">            state = 0x03</span><br><span class="line">            break</span><br><span class="line">        case 0x03:</span><br><span class="line">            length += uint16(recvByte)</span><br><span class="line">            // 一次申请缓存，初始化游标，准备读数据</span><br><span class="line">            recvBuffer = make([]byte,length)</span><br><span class="line">            cursor = 0</span><br><span class="line">            state = 0x04</span><br><span class="line">            break</span><br><span class="line">        case 0x04:</span><br><span class="line">            //不断地在这个状态下读数据，直到满足长度为止</span><br><span class="line">            recvBuffer[cursor] = recvByte</span><br><span class="line">            cursor++</span><br><span class="line">            if(cursor == length)&#123;</span><br><span class="line">                state = 0x05</span><br><span class="line">            &#125;</span><br><span class="line">            break</span><br><span class="line">        case 0x05:</span><br><span class="line">            crc16 += uint16(recvByte) * 256</span><br><span class="line">            state = 0x06</span><br><span class="line">            break</span><br><span class="line">        case 0x06:</span><br><span class="line">            crc16 += uint16(recvByte)</span><br><span class="line">            state = 0x07</span><br><span class="line">            break</span><br><span class="line">        case 0x07:</span><br><span class="line">            if recvByte == 0xFF &#123;</span><br><span class="line">                state = 0x08</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                state = 0x00</span><br><span class="line">            &#125;</span><br><span class="line">        case 0x08:</span><br><span class="line">            if recvByte == 0xFE &#123;</span><br><span class="line">                //执行数据包校验</span><br><span class="line">                if (crc32.ChecksumIEEE(recvBuffer) &gt;&gt; 16) &amp; 0xFFFF == uint32(crc16) &#123;</span><br><span class="line">                    var packet Packet</span><br><span class="line">                    //把拿到的数据反序列化出来</span><br><span class="line">                    json.Unmarshal(recvBuffer,&amp;packet)</span><br><span class="line">                    //新开协程处理数据</span><br><span class="line">                    go processRecvData(&amp;packet,conn)</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    fmt.Println(&quot;丢弃数据!&quot;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            //状态机归位,接收下一个包</span><br><span class="line">            state = 0x00</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//在这里处理收到的包，就和一般的逻辑一样了，根据类型进行不同的处理，因人而异</span><br><span class="line">//我这里处理了心跳和一个上报数据包</span><br><span class="line">//服务器往客户端的数据包很简单地以\n换行结束了，偷了一个懒:)，正常情况下也可根据自己的协议来封装好</span><br><span class="line">//然后在客户端写一个状态来处理</span><br><span class="line">func processRecvData(packet *Packet,conn net.Conn)  &#123;</span><br><span class="line">    switch packet.PacketType &#123;</span><br><span class="line">    case HEART_BEAT_PACKET:</span><br><span class="line">        var beatPacket HeartPacket</span><br><span class="line">        json.Unmarshal(packet.PacketContent,&amp;beatPacket)</span><br><span class="line">        fmt.Printf(&quot;recieve heat beat from [%s] ,data is [%v]\n&quot;,conn.RemoteAddr().String(),beatPacket)</span><br><span class="line">        conn.Write([]byte(&quot;heartBeat\n&quot;))</span><br><span class="line">        return</span><br><span class="line">    case REPORT_PACKET:</span><br><span class="line">        var reportPacket ReportPacket</span><br><span class="line">        json.Unmarshal(packet.PacketContent,&amp;reportPacket)</span><br><span class="line">        fmt.Printf(&quot;recieve report data from [%s] ,data is [%v]\n&quot;,conn.RemoteAddr().String(),reportPacket)</span><br><span class="line">        conn.Write([]byte(&quot;Report data has recive\n&quot;))</span><br><span class="line">        return</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//处理错误，根据实际情况选择这样处理，还是在函数调之后不同的地方不同处理</span><br><span class="line">func checkErr(err error) &#123;</span><br><span class="line">    if err != nil &#123;</span><br><span class="line">        fmt.Println(err)</span><br><span class="line">        os.Exit(-1)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>特别需要注意</strong><br>Handle方法在一个死循环中使用了一个无阻塞的buff来读取套接字中的数据，因此当客户端主动关闭连接时，如果不对这个io.EOF进行处理，会导致这个goroutine空转，疯狂吃cpu，在这里io.EOF的处理非常重要。</p>
<h2 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h2><p>客户端与一般的TCP通信程序一样，它需要完成的工作有：</p>
<ul>
<li><p>向服务器发送心跳包</p>
</li>
<li><p>向服务器发送数据包</p>
</li>
<li><p>接收服务器的数据包</p>
</li>
</ul>
<p>需要注意的就是客户端与服务端的数据协议保持一致，请在开始发送数据之前启动数据接收</p>
<p>上面的3个工作我分别用了goroutine来做，整体的代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">    &quot;os&quot;</span><br><span class="line">    &quot;fmt&quot;</span><br><span class="line">    &quot;net&quot;</span><br><span class="line">    &quot;time&quot;</span><br><span class="line">    &quot;math/rand&quot;</span><br><span class="line">    &quot;encoding/json&quot;</span><br><span class="line">    &quot;bufio&quot;</span><br><span class="line">    &quot;hash/crc32&quot;</span><br><span class="line">    &quot;sync&quot;</span><br><span class="line">)</span><br><span class="line">//数据包类型</span><br><span class="line">const (</span><br><span class="line">    HEART_BEAT_PACKET = 0x00</span><br><span class="line">    REPORT_PACKET = 0x01</span><br><span class="line">)</span><br><span class="line">//默认的服务器地址</span><br><span class="line">var (</span><br><span class="line">    server = &quot;127.0.0.1:9876&quot;</span><br><span class="line">)</span><br><span class="line">//数据包</span><br><span class="line">type Packet struct &#123;</span><br><span class="line">    PacketType      byte</span><br><span class="line">    PacketContent   []byte</span><br><span class="line">&#125;</span><br><span class="line">//心跳包</span><br><span class="line">type HeartPacket struct &#123;</span><br><span class="line">    Version     string`json:&quot;version&quot;`</span><br><span class="line">    Timestamp   int64`json:&quot;timestamp&quot;`</span><br><span class="line">&#125;</span><br><span class="line">//数据包</span><br><span class="line">type ReportPacket struct &#123;</span><br><span class="line">    Content   string`json:&quot;content&quot;`</span><br><span class="line">    Rand         int`json:&quot;rand&quot;`</span><br><span class="line">    Timestamp   int64`json:&quot;timestamp&quot;`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//客户端对象</span><br><span class="line">type TcpClient struct &#123;</span><br><span class="line">    connection     *net.TCPConn</span><br><span class="line">    hawkServer  *net.TCPAddr</span><br><span class="line">    stopChan       chan struct&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main()  &#123;</span><br><span class="line">    //拿到服务器地址信息</span><br><span class="line">    hawkServer,err := net.ResolveTCPAddr(&quot;tcp&quot;, server)</span><br><span class="line">    if err != nil &#123;</span><br><span class="line">        fmt.Printf(&quot;hawk server [%s] resolve error: [%s]&quot;,server,err.Error())</span><br><span class="line">        os.Exit(1)</span><br><span class="line">    &#125;</span><br><span class="line">    //连接服务器</span><br><span class="line">    connection,err := net.DialTCP(&quot;tcp&quot;,nil,hawkServer)</span><br><span class="line">    if err != nil &#123;</span><br><span class="line">        fmt.Printf(&quot;connect to hawk server error: [%s]&quot;,err.Error())</span><br><span class="line">        os.Exit(1)</span><br><span class="line">    &#125;</span><br><span class="line">    client := &amp;TcpClient&#123;</span><br><span class="line">        connection:connection,</span><br><span class="line">        hawkServer:hawkServer,</span><br><span class="line">        stopChan:make(chan struct&#123;&#125;),</span><br><span class="line">    &#125;</span><br><span class="line">    //启动接收</span><br><span class="line">    go client.receivePackets()</span><br><span class="line">    </span><br><span class="line">    //发送心跳的goroutine</span><br><span class="line">    go func() &#123;</span><br><span class="line">        heartBeatTick := time.Tick(2 * time.Second)</span><br><span class="line">        for&#123;</span><br><span class="line">            select &#123;</span><br><span class="line">            case &lt;-heartBeatTick:</span><br><span class="line">                client.sendHeartPacket()</span><br><span class="line">            case &lt;-client.stopChan:</span><br><span class="line">                return</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line">    </span><br><span class="line">    //测试用的，开300个goroutine每秒发送一个包</span><br><span class="line">    for i:=0;i&lt;300;i++ &#123;</span><br><span class="line">        go func() &#123;</span><br><span class="line">            sendTimer := time.After(1 * time.Second)</span><br><span class="line">            for&#123;</span><br><span class="line">                select &#123;</span><br><span class="line">                case &lt;-sendTimer:</span><br><span class="line">                    client.sendReportPacket()</span><br><span class="line">                    sendTimer = time.After(1 * time.Second)</span><br><span class="line">                case &lt;-client.stopChan:</span><br><span class="line">                    return</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;()</span><br><span class="line">    &#125;</span><br><span class="line">    //等待退出</span><br><span class="line">    &lt;-client.stopChan</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 接收数据包</span><br><span class="line">func (client *TcpClient)receivePackets()  &#123;</span><br><span class="line">    reader := bufio.NewReader(client.connection)</span><br><span class="line">    for &#123;</span><br><span class="line">    //承接上面说的服务器端的偷懒，我这里读也只是以\n为界限来读区分包</span><br><span class="line">        msg, err := reader.ReadString(&#x27;\n&#x27;)</span><br><span class="line">        if err != nil &#123;</span><br><span class="line">            //在这里也请处理如果服务器关闭时的异常</span><br><span class="line">            close(client.stopChan)</span><br><span class="line">            break</span><br><span class="line">        &#125;</span><br><span class="line">        fmt.Print(msg)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//发送数据包</span><br><span class="line">//仔细看代码其实这里做了两次json的序列化，有一次其实是不需要的</span><br><span class="line">func (client *TcpClient)sendReportPacket()  &#123;</span><br><span class="line">    reportPacket := ReportPacket&#123;</span><br><span class="line">        Content:getRandString(),</span><br><span class="line">        Timestamp:time.Now().Unix(),</span><br><span class="line">        Rand:rand.Int(),</span><br><span class="line">    &#125;</span><br><span class="line">    packetBytes,err := json.Marshal(reportPacket)</span><br><span class="line">    if err!=nil&#123;</span><br><span class="line">        fmt.Println(err.Error())</span><br><span class="line">    &#125;</span><br><span class="line">        //这一次其实可以不需要，在封包的地方把类型和数据传进去即可</span><br><span class="line">    packet := Packet&#123;</span><br><span class="line">        PacketType:REPORT_PACKET,</span><br><span class="line">        PacketContent:packetBytes,</span><br><span class="line">    &#125;</span><br><span class="line">    sendBytes,err := json.Marshal(packet)</span><br><span class="line">    if err!=nil&#123;</span><br><span class="line">        fmt.Println(err.Error())</span><br><span class="line">    &#125;</span><br><span class="line">    //发送</span><br><span class="line">    client.connection.Write(EnPackSendData(sendBytes))</span><br><span class="line">    fmt.Println(&quot;Send metric data success!&quot;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//使用的协议与服务器端保持一致</span><br><span class="line">func EnPackSendData(sendBytes []byte) []byte &#123;</span><br><span class="line">    packetLength := len(sendBytes) + 8</span><br><span class="line">    result := make([]byte,packetLength)</span><br><span class="line">    result[0] = 0xFF</span><br><span class="line">    result[1] = 0xFF</span><br><span class="line">    result[2] = byte(uint16(len(sendBytes)) &gt;&gt; 8)</span><br><span class="line">    result[3] = byte(uint16(len(sendBytes)) &amp; 0xFF)</span><br><span class="line">    copy(result[4:],sendBytes)</span><br><span class="line">    sendCrc := crc32.ChecksumIEEE(sendBytes)</span><br><span class="line">    result[packetLength-4] = byte(sendCrc &gt;&gt; 24)</span><br><span class="line">    result[packetLength-3] = byte(sendCrc &gt;&gt; 16 &amp; 0xFF)</span><br><span class="line">    result[packetLength-2] = 0xFF</span><br><span class="line">    result[packetLength-1] = 0xFE</span><br><span class="line">    fmt.Println(result)</span><br><span class="line">    return result</span><br><span class="line">&#125;</span><br><span class="line">//发送心跳包，与发送数据包一样</span><br><span class="line">func (client *TcpClient)sendHeartPacket() &#123;</span><br><span class="line">    heartPacket := HeartPacket&#123;</span><br><span class="line">        Version:&quot;1.0&quot;,</span><br><span class="line">        Timestamp:time.Now().Unix(),</span><br><span class="line">    &#125;</span><br><span class="line">    packetBytes,err := json.Marshal(heartPacket)</span><br><span class="line">    if err!=nil&#123;</span><br><span class="line">        fmt.Println(err.Error())</span><br><span class="line">    &#125;</span><br><span class="line">    packet := Packet&#123;</span><br><span class="line">        PacketType:HEART_BEAT_PACKET,</span><br><span class="line">        PacketContent:packetBytes,</span><br><span class="line">    &#125;</span><br><span class="line">    sendBytes,err := json.Marshal(packet)</span><br><span class="line">    if err!=nil&#123;</span><br><span class="line">        fmt.Println(err.Error())</span><br><span class="line">    &#125;</span><br><span class="line">    client.connection.Write(EnPackSendData(sendBytes))</span><br><span class="line">    fmt.Println(&quot;Send heartbeat data success!&quot;)</span><br><span class="line">&#125;</span><br><span class="line">//拿一串随机字符</span><br><span class="line">func getRandString()string  &#123;</span><br><span class="line">    length := rand.Intn(50)</span><br><span class="line">    strBytes := make([]byte,length)</span><br><span class="line">    for i:=0;i&lt;length;i++ &#123;</span><br><span class="line">        strBytes[i] = byte(rand.Intn(26) + 97)</span><br><span class="line">    &#125;</span><br><span class="line">    return string(strBytes)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>测试过程中，一共开了7个client，共计2100个goroutine，本机启动服务器端，机器配置为i-5&#x2F;8G的情况下，整体的资源使用情况如下：</p>
<p>需要改进的地方，也是后两篇的主题：</p>
<ul>
<li>引入内存池</li>
<li>服务无缝重启</li>
</ul>

    </div>

    <!-- 标签 -->
    
      <div class="post-tags">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z"></path>
          <path d="M7 7h.01"></path>
        </svg>
        
          <a href="/tags/tcp-server/" class="tag-link">tcp server</a>
        
          <a href="/tags/tcp-client/" class="tag-link">tcp client</a>
        
          <a href="/tags/golang%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" class="tag-link">golang网络编程</a>
        
      </div>
    

    <!-- 版权信息 -->
    
      <div class="post-copyright">
        <p><strong>本文作者：</strong>智慧锦囊</p>
        <p><strong>本文链接：</strong><a href="https://dongchao935.github.io/%E4%BD%BF%E7%94%A8golang%E5%BC%80%E5%8F%91Tcp%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%92%8C%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E4%BE%8B%E5%AD%90/">https://dongchao935.github.io/%E4%BD%BF%E7%94%A8golang%E5%BC%80%E5%8F%91Tcp%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%92%8C%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E4%BE%8B%E5%AD%90/</a></p>
        <p><strong>版权声明：</strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener noreferrer">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</p>
      </div>
    

    <!-- 上一篇 / 下一篇 -->
    <nav class="post-nav">
      
        <div class="post-nav-item prev disabled"></div>
      
      
      
        <a href="/%E5%AF%92%E7%AA%91%E8%B5%8B/" class="post-nav-item next">
          <span class="post-nav-label">下一篇</span>
          <span class="post-nav-title">寒窑赋</span>
        </a>
      
    </nav>
  </article>

  <!-- TOC 目录 -->
  
    <aside class="post-toc">
      <div class="toc-wrapper">
        <h3 class="toc-title">目录</h3>
        <div class="toc-content">
          <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-number">2.</span> <span class="toc-text">服务端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">3.</span> <span class="toc-text">客户端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E8%AE%B0"><span class="toc-number">4.</span> <span class="toc-text">后记</span></a></li></ol>
        </div>
      </div>
    </aside>
  
</div>

    </div>
  </main>

  <footer class="site-footer">
  <div class="footer-container">
    <div class="footer-content">
      <!-- 版权信息 -->
      <div class="footer-copyright">
        <p>
          &copy; 
          
            2025 - 
          
          2026 
          <a href="/">智慧锦囊</a>
        </p>
      </div>

      <!-- 社交链接 -->
      
        <div class="footer-social">
          
            <a href="https://github.com/CoderFrish" target="_blank" rel="noopener noreferrer" aria-label="GitHub" title="GitHub">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path>
                <path d="M9 18c-4.51 2-5-2-7-2"></path>
              </svg>
            </a>
          
          
          
            <a href="mailto:1573880184@qq.com" aria-label="Email" title="Email">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect width="20" height="16" x="2" y="4" rx="2"></rect>
                <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path>
              </svg>
            </a>
          
        </div>
      

      <!-- 技术支持 -->
      <div class="footer-powered">
        <p>
          Powered by <a href="https://hexo.io" target="_blank" rel="noopener noreferrer">Hexo</a>
          <span class="separator">|</span>
          Theme Hydrogen
        </p>
      </div>

      <!-- 备案信息 -->
      

      <!-- 自定义内容 -->
      
    </div>
  </div>

  <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?8dc24376a142a24438b6226fac699a76";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
</footer>

  
  <!-- 搜索模态框 -->
  
    <div id="search-modal" class="search-modal">
  <div class="search-container">
    <!-- 搜索头部 -->
    <div class="search-header">
      <div class="search-input-wrapper">
        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.3-4.3"></path>
        </svg>
        <input 
          type="text" 
          id="search-input" 
          class="search-input" 
          placeholder="搜索文章、文档..." 
          autocomplete="off"
          autofocus
        >
        <button class="search-close" aria-label="关闭">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M18 6 6 18"></path>
            <path d="m6 6 12 12"></path>
          </svg>
        </button>
      </div>
      <div class="search-shortcut">
        <kbd>ESC</kbd> 关闭
        <span class="shortcut-divider">|</span>
        <kbd>↑</kbd><kbd>↓</kbd> 导航
        <span class="shortcut-divider">|</span>
        <kbd>Enter</kbd> 打开
      </div>
    </div>

    <!-- 搜索结果 -->
    <div id="search-results" class="search-results">
      <div class="search-tip">输入关键词开始搜索</div>
    </div>

    <!-- 搜索页脚 -->
    <div class="search-footer">
      <span class="search-footer-text">
        <kbd>Ctrl</kbd> + <kbd>K</kbd> 快速搜索
      </span>
    </div>
  </div>
</div>

  

  <!-- 站点配置 -->
  <script>
    window.STARTER_CONFIG = {
      root: '/',
      searchEnabled: true
    };
  </script>

  <!-- 主脚本 -->
  
<script src="/js/main.js"></script>

  
  
    
<script src="/js/search.js"></script>

  
</body>
</html>
